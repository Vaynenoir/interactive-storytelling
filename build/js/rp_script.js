$(document).ready(function(){function t(t){var e=JSON.parse(localStorage.getItem("Settings"))||{mapColor:"rgba(255, 204, 128, 1)",mapStrokeColor:"rgba(0, 0, 0, 1)",mapPointsColor:"rgba(0, 0, 255, 1)",mapPointsBorderColor:"rgba(0, 0, 0, 1)",mapRouteColor:"rgba(0, 0, 0, 1)",bodyBackgroundColor:"rgba(243, 229, 245, 1)",routeBorderWidth:"4",pointsRadius:"8",pointsBorderWidth:"1",contentWidth:"100",contentAlign:"flex-start"};if(e[t])return e[t]}function e(t){if(!$(t).length)return!1;var e=$(t).offset().top,o=$(t).offset().top+$(t).outerHeight(),a=$(window).scrollTop()+$(window).height(),r=$(window).scrollTop();return a>e&&r<o}var o=JSON.parse(localStorage.getItem("PointsContent"))||[];JSON.parse(localStorage.getItem("SavedMapColors"));o&&o.sort(function(t,e){return t.pointId-e.pointId});for(var a=document.getElementById("boom"),r=0;r<o.length;r++){var s=document.createElement("section");$(s).addClass("js-section"),$(s).attr({"data-zoom":o[r].zoom+"%","data-pos-top":o[r].top+"%","data-pos-bottom":o[r].bottom+"%","data-pos-left":o[r].left+"%","data-pos-right":o[r].bottom+"%",id:"section_"+(r+1)}),s.insertAdjacentHTML("beforeend",o[r].data),$(s).find("img").addClass("js-image"),$(s).find(".js-image").attr("data-pos-x",0),$(s).find(".js-image").attr("data-pos-y",0),a.append(s),$("div.text_wrapper").css("align-items",t("contentAlign")),$(".js-section").css("width",t("contentWidth")+"%")}$(".mapbg").css("zoom","0%"),$(".mapbg").css("right","0"),$("mapbg").css("bottom","0");var n=document.getElementById("map"),i=JSON.parse(localStorage.getItem("map"));console.log(i),$("#map").attr("data",i),n.addEventListener("load",function(){console.log($("#map").attr("data"));for(var r=n.contentDocument,s=r.documentElement,i=s.getElementById("mapPaths").getElementsByTagName("path"),l=0;l<i.length;l++)i[l].style.fill=t("mapColor"),i[l].style.stroke=t("mapStrokeColor");var c=JSON.parse(localStorage.getItem("path"));if($(s).addClass("my-svg"),c){var p=document.createElementNS("http://www.w3.org/2000/svg","path");$(p).attr("d",c),$(p).attr("fill","transparent"),$(p).attr("stroke",t("mapRouteColor")),$(p).attr("opacity","0.8"),$(p).attr("stroke-width",t("routeBorderWidth")),$(p).attr("stroke-linecap","round"),$(p).attr("id","routePath")}var d=parseInt($("#IDmapbg")[0].style.top),g=parseInt($("#IDmapbg")[0].style.left),m=document.createElementNS("http://www.w3.org/2000/svg","path");$(m).css("display","none"),Snap.plugin(function(t,e,o,a){o.prototype.circlePath=function(t,e,o){var a="M"+t+","+e;return a+="m"+-o+",0",a+="a"+o+","+o+" 0 1,0 "+2*o+",0",a+="a"+o+","+o+" 0 1,0 "+-2*o+",0",this.path(a,t,e)}});var h=document.createElementNS("http://www.w3.org/2000/svg","g");h.id="pathGroup",h.append(p),s.append(h);var f=Snap(h),u=JSON.parse(localStorage.getItem("circlesCoords"));$.each(u,function(e,o){var a=f.circlePath(this.cx,this.cy,this.r).attr({fill:t("mapPointsColor"),stroke:t("mapPointsBorderColor"),"stroke-width":t("pointsBorderWidth"),id:e+1,class:"circleElement",style:"display:none"});Snap.path.intersection(a,$(p).attr("d")).forEach(function(t){f.circle(t.x,t.y,1)})});var v=s.getElementById("pathGroup");console.log(v);for(l=0;l<u.length;l++){var w=document.createElementNS("http://www.w3.org/2000/svg","g"),S=s.getElementById(l+1);w.append(S);var y=document.createElementNS("http://www.w3.org/2000/svg","text");$(y).attr({x:u[l].cx,y:u[l].cy+20,"font-size":12,"font-style":"italic",fill:"#ccccccc",style:"display: none",class:"cityName"}),$(y).text(o[l].cityName),console.log(y),w.append(y),v.append(w),console.log(S),s.append(w)}var I=r.getElementsByTagName("circle");for(l=0;l<I.length;l++)I[l].style.fill="transparent";var b=JSON.parse(localStorage.getItem("StartRouteIcon"))||[],C=(new DOMParser).parseFromString(b,"text/xml").documentElement,x=$(C).attr("data-offset-x"),E=$(C).attr("data-offset-y"),N=$(C).attr("data-scale"),k=document.createElementNS("http://www.w3.org/2000/svg","g");if("true"==t("UserOption")&&t("StartIcon").length>0)for(l=0;l<b.length;l++)$(C).attr({fill:t("RouteStartIconColor"),transform:N});if($(k).attr("transform","translate("+(p.getPointAtLength(1).x-t("RouteStartIconSize")/x)+" "+(p.getPointAtLength(1).y-t("RouteStartIconSize")/E)+") scale("+t("RouteStartIconSize")/100+")"),k.append(C),s.append(k),"true"==t("checkboxState")&&"true"==t("defaultOption")){var B=document.createElementNS("http://www.w3.org/2000/svg","circle");$(B).attr({cx:p.getPointAtLength(1).x,cy:p.getPointAtLength(1).y,r:t("pointsRadius"),stroke:t("mapPointsBorderColor"),fill:t("mapPointsColor"),"stroke-width":t("pointsBorderWidth")}),s.append(B)}a.style.display="block";var O=p.getTotalLength(),P=($(p).css({"stroke-dashoffset":O,"stroke-dasharray":O+" "+O}),JSON.parse(localStorage.getItem("stopsAtLength")));$(window).on("scroll",function(t){!function(){var t=r.querySelectorAll(".circleElement"),e=r.querySelectorAll(".cityName");console.log(e);for(var o=0;o<P.length;o++)$.each($(".js-section"),function(o,a){if($(this).hasClass("active")){var s=($(window).scrollTop()-$(this).offset().top)/$(this).height()*100,n=$(this).attr("id");n=parseInt(n[8])-1;var i,l=s*(P[n]/100);i=Math.floor(l);for(var c=r.getElementById(n+1),d=parseFloat($(p).css("stroke-dashoffset")),g=0;g<t.length;g++)$(c).parent().find("text"),d>=O-20?($(t[g]).fadeOut(900),$(e[g]).fadeOut(900)):t[g].id<=n+1?($(t[g]).fadeIn(900),$(e[g]).fadeIn(900)):t[g].id>n+1&&($(t[g]).fadeOut(900),$(e[g]).fadeOut(900));i<P[n]&&(0==n&&i<P[n]&&$(p).css("stroke-dashoffset",O-i+"px"),n>0&&i<P[n]&&$(p).css("stroke-dashoffset",""+(O-(P[n-1]+i)))),P[n-1]+i>P[n]&&$(p).css("stroke-dashoffset",O-P[n]+"px")}})}(),function(){$(".js-section").each(function(t){var o=$(window).scrollTop(),a=$(this).offset().top,r=$(this).attr("data-zoom"),s=parseInt($(this).attr("data-pos-top"))+d+"%",n=$(this).attr("data-pos-bottom"),i=parseInt($(this).attr("data-pos-left"))+g+"%",l=$(this).attr("data-pos-right");a<=o&&e($(this))?($(this).addClass("active"),$(".mapbg").stop().animate({zoom:r,left:i,right:l,top:s,bottom:n},700)):($(this).removeClass("active"),!$(".js-section").hasClass("active")&&$(window).scrollTop()<20&&$(".mapbg").stop().animate({left:g+"%",top:d+"%",zoom:"100%"},400))});var t=[];$(".js-image").each(function(e){t.push($(this))});var o=JSON.parse(localStorage.getItem("circlesCoords"));$(t).each(function(t,e){var a=$(this).closest("section")[0].id;(a=parseInt(a[8])-1)==o[t].id-1&&$(this).attr({"data-pos-x":o[a].cx,"data-pos-y":o[a].cy})});var a=0;$(t).each(function(){if(e($(this))){a++;var t=$(this).attr("data-pos-x"),o=$(this).attr("data-pos-y"),r=$(this)[0].getBoundingClientRect();r.top,$(this).height(),$(m).attr("d","M"+t+" "+o+" L"+(-r.left-100)+" "+(r.top-110)+" L"+(-r.left-100)+" "+(r.bottom-160)),$(m).css("position","relative"),$(m).attr("fill","#47DBB4"),$(m).attr("opacity",".2")}}),s.append(m),a>0?$(m).fadeIn(900):$(m).fadeOut(900)}()})},!1);var l=JSON.parse(localStorage.getItem("mapStyleProperties"));console.log(l),$("#IDmapbg").css("background-color",t("bodyBackgroundColor")),$.each(l,function(t,e){$("#IDmapbg").css(t,e)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJwX3NjcmlwdC5qcyJdLCJuYW1lcyI6WyIkIiwiZG9jdW1lbnQiLCJyZWFkeSIsImdldFNldHRpbmdGcm9tU3RvcmFnZSIsInNldHRpbmciLCJTZXR0aW5nc09iamVjdCIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJtYXBDb2xvciIsIm1hcFN0cm9rZUNvbG9yIiwibWFwUG9pbnRzQ29sb3IiLCJtYXBQb2ludHNCb3JkZXJDb2xvciIsIm1hcFJvdXRlQ29sb3IiLCJib2R5QmFja2dyb3VuZENvbG9yIiwicm91dGVCb3JkZXJXaWR0aCIsInBvaW50c1JhZGl1cyIsInBvaW50c0JvcmRlcldpZHRoIiwiY29udGVudFdpZHRoIiwiY29udGVudEFsaWduIiwiaW5XaW5kb3ciLCJzIiwibGVuZ3RoIiwiaW1nX3RvcF9vZmZzZXQiLCJvZmZzZXQiLCJ0b3AiLCJpbWdfYm90dG9tIiwib3V0ZXJIZWlnaHQiLCJib3R0b21PZlNjcmVlbiIsIndpbmRvdyIsInNjcm9sbFRvcCIsImhlaWdodCIsInRvcE9mU2NyZWVuIiwiZGF0YUNvbnRlbnQiLCJzb3J0Iiwib2JqQSIsIm9iakIiLCJwb2ludElkIiwidGV4dF9jb250IiwiZ2V0RWxlbWVudEJ5SWQiLCJpIiwic2VjdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJhZGRDbGFzcyIsImF0dHIiLCJkYXRhLXpvb20iLCJ6b29tIiwiZGF0YS1wb3MtdG9wIiwiZGF0YS1wb3MtYm90dG9tIiwiYm90dG9tIiwiZGF0YS1wb3MtbGVmdCIsImxlZnQiLCJkYXRhLXBvcy1yaWdodCIsImlkIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwiZGF0YSIsImZpbmQiLCJhcHBlbmQiLCJjc3MiLCJhIiwibWFwX3VybF90cnVlIiwiY29uc29sZSIsImxvZyIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdmdEb2MiLCJjb250ZW50RG9jdW1lbnQiLCJzdmdSb290IiwiZG9jdW1lbnRFbGVtZW50IiwiUGF0aHNBcnJheSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwic3R5bGUiLCJmaWxsIiwic3Ryb2tlIiwiUGF0aERpcmVjdGlvbiIsInBhdGgiLCJjcmVhdGVFbGVtZW50TlMiLCJjdXJyZW50RGlzcGxhY2VtZW50VG9wIiwicGFyc2VJbnQiLCJjdXJyZW50RGlzcGxhY2VtZW50TGVmdCIsInBhdGgxIiwiU25hcCIsInBsdWdpbiIsIkVsZW1lbnQiLCJQYXBlciIsImdsb2JhbCIsInByb3RvdHlwZSIsImNpcmNsZVBhdGgiLCJjeCIsImN5IiwiciIsInAiLCJ0aGlzIiwicGF0aEdyb3VwIiwiY2lyY2xlc0FycmF5IiwiZWFjaCIsImluZGV4IiwiZWwiLCJjaXJjbGUiLCJzdHJva2Utd2lkdGgiLCJjbGFzcyIsImludGVyc2VjdGlvbiIsImZvckVhY2giLCJ4IiwieSIsIlBhcmVudENpY2xlR3JvdXAiLCJjaXJjbGVHcm91cCIsImN1cnJlbnRQb2ludCIsInRleHQiLCJmb250LXNpemUiLCJmb250LXN0eWxlIiwiY2l0eU5hbWUiLCJpbnRlcnNlY3Rpb25DaXJjbGVzIiwicGF0aFN0YXJ0SWNvbiIsInBhcnNlZFBhdGhTdGFydEljb24iLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJpY29uT2Zmc2V0WCIsImljb25PZmZzZXRZIiwiaWNvblNjYWxlIiwiZ3JvdXAiLCJ0cmFuc2Zvcm0iLCJnZXRQb2ludEF0TGVuZ3RoIiwic3RhcnRDaXJjbGUiLCJkaXNwbGF5IiwiZ2V0VG90YWxMZW5ndGgiLCJTdG9wUG9pbnRzIiwic3Ryb2tlLWRhc2hvZmZzZXQiLCJzdHJva2UtZGFzaGFycmF5Iiwib24iLCJlIiwiY2lyY2xlRWxlbWVudHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwidGV4dEVsZW1lbnRzIiwiaGFzQ2xhc3MiLCIkcGVyY2VudGFnZUNvbXBsZXRlIiwiY3VycmVudFNlY3Rpb25JRCIsIkN1cnJlbnRQYXRoQ3VycmVudExlbmd0aCIsIiRvZmZzZXRVbml0IiwiTWF0aCIsImZsb29yIiwiY3VycmVudENpcmNsZSIsImN1ckRhc2hPZmZzZXQiLCJwYXJzZUZsb2F0IiwiaiIsInBhcmVudCIsImZhZGVPdXQiLCJmYWRlSW4iLCJkcmF3UGF0aCIsInNjcm9sbENvdW50IiwidG9wT2Zmc2V0IiwiZGF0YVpvb20iLCJkYXRhUG9zVG9wIiwiZGF0YVBvc0JvdHRvbSIsImRhdGFQb3NMZWZ0IiwiZGF0YVBvc1JpZ2h0Iiwic3RvcCIsImFuaW1hdGUiLCJyaWdodCIsInJlbW92ZUNsYXNzIiwiYXJySW1nSUQiLCJwdXNoIiwiQ2lyY2xlUGF0aENvb3JkcyIsImltZ1BhcmVudElEIiwiY2xvc2VzdCIsImRhdGEtcG9zLXgiLCJkYXRhLXBvcy15IiwidmlzX2NvdW50IiwiQ29vcmRpbmF0ZXMiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzZWN0aW9uQ291bnRlciIsIldyYXBwZXJQcm9wcyIsInByb3AiLCJ2YWx1ZSJdLCJtYXBwaW5ncyI6IkFBQUFBLEVBQUVDLFVBQVVDLE1BQU0sV0FFZCxTQUFTQyxFQUFzQkMsR0FDM0IsSUFBSUMsRUFBaUJDLEtBQUtDLE1BQU1DLGFBQWFDLFFBQVEsZUFDckRDLFNBQVUseUJBQ1ZDLGVBQWdCLG1CQUNoQkMsZUFBZ0IscUJBQ2hCQyxxQkFBc0IsbUJBQ3RCQyxjQUFlLG1CQUNmQyxvQkFBcUIseUJBQ3JCQyxpQkFBa0IsSUFDbEJDLGFBQWMsSUFDZEMsa0JBQW1CLElBQ25CQyxhQUFjLE1BQ2RDLGFBQWMsY0FHZCxHQUFHZixFQUFlRCxHQUNkLE9BQU9DLEVBQWVELEdBUTlCLFNBQVNpQixFQUFTQyxHQUNkLElBQUt0QixFQUFFc0IsR0FBR0MsT0FBUSxPQUFPLEVBRXpCLElBQUlDLEVBQWlCeEIsRUFBRXNCLEdBQUdHLFNBQVNDLElBQy9CQyxFQUFhM0IsRUFBRXNCLEdBQUdHLFNBQVNDLElBQU0xQixFQUFFc0IsR0FBR00sY0FDdENDLEVBQWlCN0IsRUFBRThCLFFBQVFDLFlBQWMvQixFQUFFOEIsUUFBUUUsU0FDbkRDLEVBQWNqQyxFQUFFOEIsUUFBUUMsWUFFNUIsT0FBUUYsRUFBaUJM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bGUiOiJycF9zY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgIC8vIGdldCBlZGl0b3Igc2V0dGluZ3NcclxuICAgIGZ1bmN0aW9uIGdldFNldHRpbmdGcm9tU3RvcmFnZShzZXR0aW5nKXtcclxuICAgICAgICB2YXIgU2V0dGluZ3NPYmplY3QgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiU2V0dGluZ3NcIikpIHx8IHtcclxuICAgICAgICBtYXBDb2xvcjogXCJyZ2JhKDI1NSwgMjA0LCAxMjgsIDEpXCIsXHJcbiAgICAgICAgbWFwU3Ryb2tlQ29sb3I6IFwicmdiYSgwLCAwLCAwLCAxKVwiLFxyXG4gICAgICAgIG1hcFBvaW50c0NvbG9yOiBcInJnYmEoMCwgMCwgMjU1LCAxKVwiLFxyXG4gICAgICAgIG1hcFBvaW50c0JvcmRlckNvbG9yOiBcInJnYmEoMCwgMCwgMCwgMSlcIixcclxuICAgICAgICBtYXBSb3V0ZUNvbG9yOiBcInJnYmEoMCwgMCwgMCwgMSlcIixcclxuICAgICAgICBib2R5QmFja2dyb3VuZENvbG9yOiBcInJnYmEoMjQzLCAyMjksIDI0NSwgMSlcIixcclxuICAgICAgICByb3V0ZUJvcmRlcldpZHRoOiBcIjRcIixcclxuICAgICAgICBwb2ludHNSYWRpdXM6IFwiOFwiLFxyXG4gICAgICAgIHBvaW50c0JvcmRlcldpZHRoOiBcIjFcIixcclxuICAgICAgICBjb250ZW50V2lkdGg6IFwiMTAwXCIsXHJcbiAgICAgICAgY29udGVudEFsaWduOiBcImZsZXgtc3RhcnRcIlxyXG4gICAgfTtcclxuXHJcbiAgICAgICAgaWYoU2V0dGluZ3NPYmplY3Rbc2V0dGluZ10pe1xyXG4gICAgICAgICAgICByZXR1cm4gU2V0dGluZ3NPYmplY3Rbc2V0dGluZ107XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YXIgZGF0YUNvbnRlbnQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdQb2ludHNDb250ZW50JykpIHx8IFtdO1xyXG4gICAgdmFyIGNpcmNsZUNvbG9yID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIlNhdmVkTWFwQ29sb3JzXCIpKSB8fCB7fTtcclxuXHJcbiAgICBmdW5jdGlvbiBpbldpbmRvdyhzKSB7IC8vIGNoZWNrIGlmIGVsZW1lbnQgaXMgdmlzaWJsZSBpbiBicm93c2VyIHdpbmRvd1xyXG4gICAgICAgIGlmICghJChzKS5sZW5ndGgpIHJldHVybiBmYWxzZTsgLy8gZWxlbWVudCBub3QgZm91bmRcclxuXHJcbiAgICAgICAgdmFyIGltZ190b3Bfb2Zmc2V0ID0gJChzKS5vZmZzZXQoKS50b3A7XHJcbiAgICAgICAgdmFyIGltZ19ib3R0b20gPSAkKHMpLm9mZnNldCgpLnRvcCArICQocykub3V0ZXJIZWlnaHQoKTtcclxuICAgICAgICB2YXIgYm90dG9tT2ZTY3JlZW4gPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCkgKyAkKHdpbmRvdykuaGVpZ2h0KCk7XHJcbiAgICAgICAgdmFyIHRvcE9mU2NyZWVuID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xyXG5cclxuICAgICAgICByZXR1cm4gKGJvdHRvbU9mU2NyZWVuID4gaW1nX3RvcF9vZmZzZXQpICYmICh0b3BPZlNjcmVlbiA8IGltZ19ib3R0b20pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNvbXBhcmVJZChvYmpBLCBvYmpCKSB7IC8vc29ydCBwb2ludHMgaWQgYnkgYXNjZW5kaW5nXHJcbiAgICAgICAgcmV0dXJuIG9iakEucG9pbnRJZCAtIG9iakIucG9pbnRJZDtcclxuICAgIH1cclxuXHJcbiAgICBpZihkYXRhQ29udGVudCl7XHJcbiAgICBkYXRhQ29udGVudC5zb3J0KGNvbXBhcmVJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRleHRfY29udCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9vbVwiKTtcclxuXHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGFDb250ZW50Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgdmFyIHNlY3Rpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWN0aW9uJyk7ICAgIC8vIGNyZWF0aW9uIG9mIHBhZ2Ugc2VjdGlvbnMgd2l0aCBpdCdzIGNvbnRlbnQsIHRpZWQgdG8gZXZlcnkgcG9pbnRcclxuICAgICAgICAkKHNlY3Rpb24pLmFkZENsYXNzKCdqcy1zZWN0aW9uJyk7XHJcblxyXG4gICAgICAgXHJcbiAgICAgICAgJChzZWN0aW9uKS5hdHRyKHtcclxuICAgICAgICAgICAgXCJkYXRhLXpvb21cIjogZGF0YUNvbnRlbnRbaV0uem9vbSArIFwiJVwiLFxyXG4gICAgICAgICAgICBcImRhdGEtcG9zLXRvcFwiOiBkYXRhQ29udGVudFtpXS50b3AgKyBcIiVcIiwgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcImRhdGEtcG9zLWJvdHRvbVwiOiBkYXRhQ29udGVudFtpXS5ib3R0b20gKyBcIiVcIixcclxuICAgICAgICAgICAgXCJkYXRhLXBvcy1sZWZ0XCI6IGRhdGFDb250ZW50W2ldLmxlZnQgKyBcIiVcIixcclxuICAgICAgICAgICAgXCJkYXRhLXBvcy1yaWdodFwiOiBkYXRhQ29udGVudFtpXS5ib3R0b20gKyBcIiVcIixcclxuICAgICAgICAgICAgXCJpZFwiOiBcInNlY3Rpb25fXCIgKyAoaSsxKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBzZWN0aW9uLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgZGF0YUNvbnRlbnRbaV0uZGF0YSk7XHJcbiAgICAgICAgJChzZWN0aW9uKS5maW5kKCdpbWcnKS5hZGRDbGFzcygnanMtaW1hZ2UnKTtcclxuICAgICAgICAkKHNlY3Rpb24pLmZpbmQoJy5qcy1pbWFnZScpLmF0dHIoJ2RhdGEtcG9zLXgnLCAwKTtcclxuICAgICAgICAkKHNlY3Rpb24pLmZpbmQoJy5qcy1pbWFnZScpLmF0dHIoJ2RhdGEtcG9zLXknLCAwKTtcclxuXHJcblxyXG4gICAgICAgIHRleHRfY29udC5hcHBlbmQoc2VjdGlvbik7XHJcbiAgICAgICAgJChcImRpdi50ZXh0X3dyYXBwZXJcIikuY3NzKFwiYWxpZ24taXRlbXNcIiwgZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwiY29udGVudEFsaWduXCIpICk7XHJcbiAgICAgICAgICQoJy5qcy1zZWN0aW9uJykuY3NzKFwid2lkdGhcIiwgZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwiY29udGVudFdpZHRoXCIpICsgXCIlXCIpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgJCgnLm1hcGJnJykuY3NzKFwiem9vbVwiLCBcIjAlXCIpO1xyXG4gICAgJCgnLm1hcGJnJykuY3NzKFwicmlnaHRcIiwgXCIwXCIpO1xyXG4gICAgJCgnbWFwYmcnKS5jc3MoXCJib3R0b21cIiwgXCIwXCIpO1xyXG4gICAgdmFyIGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyk7XHJcblxyXG4gICAgdmFyIG1hcF91cmwgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtYXAnKSk7XHJcbiAgICB2YXIgbWFwX3VybF90cnVlID0gbWFwX3VybDtcclxuICAgIGNvbnNvbGUubG9nKG1hcF91cmxfdHJ1ZSk7XHJcblxyXG4gICAgJCgnI21hcCcpLmF0dHIoJ2RhdGEnLCBtYXBfdXJsX3RydWUpOyBcclxuXHJcbiAgICBhLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGZ1bmN0aW9uKCkgeyAvL2xvYWRpbmcgbWFwIHVybCBmcm9tIGxvY2Fsc3RvcmFnZVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygkKFwiI21hcFwiKS5hdHRyKCdkYXRhJykpO1xyXG4gICAgICAgIHZhciBzdmdEb2MgPSBhLmNvbnRlbnREb2N1bWVudDtcclxuICAgICAgICB2YXIgc3ZnUm9vdCA9IHN2Z0RvYy5kb2N1bWVudEVsZW1lbnQ7ICAvL2dldHRpbmcgaW50byBvYmplY3QgRE9NXHJcblxyXG4gICAgICAgIHZhciBNYXBQYXRoc0dyb3VwID0gc3ZnUm9vdC5nZXRFbGVtZW50QnlJZChcIm1hcFBhdGhzXCIpO1xyXG4gICAgICAgIHZhciBQYXRoc0FycmF5ID0gTWFwUGF0aHNHcm91cC5nZXRFbGVtZW50c0J5VGFnTmFtZSgncGF0aCcpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IFBhdGhzQXJyYXkubGVuZ3RoOyBpKyspeyAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgUGF0aHNBcnJheVtpXS5zdHlsZS5maWxsID0gZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwibWFwQ29sb3JcIik7ICAgICAgIC8vY29sb3JpbmcgbWFwIGFuZCBtYXAgc3Ryb2tlIGZyb20gc2V0dGluZ3NcclxuICAgICAgICAgICAgUGF0aHNBcnJheVtpXS5zdHlsZS5zdHJva2UgPSBnZXRTZXR0aW5nRnJvbVN0b3JhZ2UoXCJtYXBTdHJva2VDb2xvclwiKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2YXIgUGF0aERpcmVjdGlvbiA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BhdGgnKSk7ICAgLy8gZ2V0ICBkaXJlY3Rpb24gb2YgbWFpbiByb3V0ZVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhzdmdSb290KTtcclxuICAgICAgICAkKHN2Z1Jvb3QpLmFkZENsYXNzKFwibXktc3ZnXCIpO1xyXG5cclxuICAgICAgICBpZiAoUGF0aERpcmVjdGlvbikgeyAgIC8vIG1haW4gcm91dGUgc3R5bGluZ1xyXG4gICAgICAgICAgICB2YXIgcGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncGF0aCcpO1xyXG5cclxuICAgICAgICAgICAgJChwYXRoKS5hdHRyKCdkJywgUGF0aERpcmVjdGlvbik7XHJcbiAgICAgICAgICAgICQocGF0aCkuYXR0cignZmlsbCcsICd0cmFuc3BhcmVudCcpO1xyXG4gICAgICAgICAgICAkKHBhdGgpLmF0dHIoJ3N0cm9rZScsIGdldFNldHRpbmdGcm9tU3RvcmFnZShcIm1hcFJvdXRlQ29sb3JcIikpO1xyXG4gICAgICAgICAgICAkKHBhdGgpLmF0dHIoXCJvcGFjaXR5XCIsICcwLjgnKTtcclxuICAgICAgICAgICAgJChwYXRoKS5hdHRyKCdzdHJva2Utd2lkdGgnLCBnZXRTZXR0aW5nRnJvbVN0b3JhZ2UoXCJyb3V0ZUJvcmRlcldpZHRoXCIpKTtcclxuICAgICAgICAgICAgJChwYXRoKS5hdHRyKFwic3Ryb2tlLWxpbmVjYXBcIixcInJvdW5kXCIpXHJcbiAgICAgICAgICAgICQocGF0aCkuYXR0cihcImlkXCIsIFwicm91dGVQYXRoXCIpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHZhciBjdXJyZW50RGlzcGxhY2VtZW50VG9wID0gcGFyc2VJbnQoJChcIiNJRG1hcGJnXCIpWzBdLnN0eWxlLnRvcCk7ICAvLyBtYXAgb2Zmc2V0IHNldCB1cCBieSB1c2VyIG9uIDFzdCBzdGVwXHJcbiAgICAgICAgdmFyIGN1cnJlbnREaXNwbGFjZW1lbnRMZWZ0ID0gcGFyc2VJbnQoJCgnI0lEbWFwYmcnKVswXS5zdHlsZS5sZWZ0KTtcclxuICAgICAgICB2YXIgcGF0aDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BhdGgnKTtcclxuICAgICAgICAkKHBhdGgxKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2VjdGlvbkNvdW50ZXIoKSB7XHJcbiAgICAgICAgICAgICQoJy5qcy1zZWN0aW9uJykuZWFjaChmdW5jdGlvbihpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNjcm9sbENvdW50ID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvcE9mZnNldCA9ICQodGhpcykub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFab29tID0gJCh0aGlzKS5hdHRyKFwiZGF0YS16b29tXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFQb3NUb3AgPSBwYXJzZUludCgkKHRoaXMpLmF0dHIoXCJkYXRhLXBvcy10b3BcIikpICsgY3VycmVudERpc3BsYWNlbWVudFRvcCArIFwiJVwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFQb3NCb3R0b20gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtcG9zLWJvdHRvbScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFQb3NMZWZ0ID0gcGFyc2VJbnQoJCh0aGlzKS5hdHRyKFwiZGF0YS1wb3MtbGVmdFwiKSkgKyBjdXJyZW50RGlzcGxhY2VtZW50TGVmdCArIFwiJVwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFQb3NSaWdodCA9ICQodGhpcykuYXR0cihcImRhdGEtcG9zLXJpZ2h0XCIpO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRvcE9mZnNldCA8PSBzY3JvbGxDb3VudCAmJiBpbldpbmRvdygkKHRoaXMpKSkgeyAvL0FkZCBjbGFzcyBcImFjdGl2ZVwiIGlmIGN1cnJlbnQgc2VjdGlvbiBpcyBpbldpbmRvd1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcubWFwYmcnKS5zdG9wKCkuYW5pbWF0ZSh7IC8vYW5pbWF0ZSBtYXAgem9vbSBhbmQgb2Zmc2V0LCBzZXQgdXAgYnkgdXNlciBvbiAybmQgc3RlcCwgZHVlIHRvIGN1cnJlbnQgc2VjdGlvbiAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHpvb206IGRhdGFab29tLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBkYXRhUG9zTGVmdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IGRhdGFQb3NSaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBkYXRhUG9zVG9wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib3R0b206IGRhdGFQb3NCb3R0b21cclxuICAgICAgICAgICAgICAgICAgICB9LCA3MDApO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISQoJy5qcy1zZWN0aW9uJykuaGFzQ2xhc3MoXCJhY3RpdmVcIikgJiYgJCh3aW5kb3cpLnNjcm9sbFRvcCgpIDwgMjApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1hcGJnJykuc3RvcCgpLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogY3VycmVudERpc3BsYWNlbWVudExlZnQgKyBcIiVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogY3VycmVudERpc3BsYWNlbWVudFRvcCArIFwiJVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogXCIxMDAlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgNDAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFyckltZ0lEID0gW107IC8vYXJyYXkgb2YgcGFnZSBpbWcgZWxlbWVudHNcclxuICAgICAgICAgICAgJCgnLmpzLWltYWdlJykuZWFjaChmdW5jdGlvbihlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGFyckltZ0lELnB1c2goJCh0aGlzKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHZhciBDaXJjbGVQYXRoQ29vcmRzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2lyY2xlc0Nvb3JkcycpKTtcclxuXHJcbiAgICAgICAgICAgICQoYXJySW1nSUQpLmVhY2goZnVuY3Rpb24oaSwgZWwpIHsgLy9nZXQgY29vcmRpbmF0ZXMgb2YgcG9pbnQgd2hpY2ggaXMgdGllZCB3aXRoIGN1cnJlbnQgaW1nXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGltZ1BhcmVudElEID0gJCh0aGlzKS5jbG9zZXN0KCdzZWN0aW9uJylbMF0uaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaW1nUGFyZW50SUQgPSBwYXJzZUludChpbWdQYXJlbnRJRFs4XSkgLSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKGltZ1BhcmVudElEID09IENpcmNsZVBhdGhDb29yZHNbaV0uaWQtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuYXR0cih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXBvcy14JzogQ2lyY2xlUGF0aENvb3Jkc1tpbWdQYXJlbnRJRF0uY3gsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXBvcy15JzogQ2lyY2xlUGF0aENvb3Jkc1tpbWdQYXJlbnRJRF0uY3lcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgdmlzX2NvdW50ID0gMDtcclxuXHJcbiAgICAgICAgICAgICQoYXJySW1nSUQpLmVhY2goZnVuY3Rpb24oKSB7ICAvL2lmIGN1cnJlbnQgaW1nIGluV2luZG93LCB0aGFuIGNyZWF0ZSBhIGxpZ2h0IGZyb20gY3VycmVudCBwb2ludCB0byBpbWcncyBib3JkZXJcclxuICAgICAgICAgICAgICAgIGlmIChpbldpbmRvdygkKHRoaXMpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpc19jb3VudCsrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3ggPSAkKHRoaXMpLmF0dHIoJ2RhdGEtcG9zLXgnKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3kgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtcG9zLXknKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIENvb3JkaW5hdGVzID0gJCh0aGlzKVswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYm90dG9tT2Zmc2V0SW1nID0gQ29vcmRpbmF0ZXMudG9wICsgJCh0aGlzKS5oZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAkKHBhdGgxKS5hdHRyKCdkJywgXCJNXCIgKyBjeCArIFwiIFwiICsgY3kgKyBcIiBMXCIgKyAoLUNvb3JkaW5hdGVzLmxlZnQtMTAwKSArIFwiIFwiICsgKENvb3JkaW5hdGVzLnRvcCAtIDExMCkgKyBcIiBMXCIgKyAoLUNvb3JkaW5hdGVzLmxlZnQtMTAwKSArIFwiIFwiICsgKENvb3JkaW5hdGVzLmJvdHRvbSAtIDE2MCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICQocGF0aDEpLmNzcygncG9zaXRpb24nLCBcInJlbGF0aXZlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICQocGF0aDEpLmF0dHIoJ2ZpbGwnLCAnIzQ3REJCNCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICQocGF0aDEpLmF0dHIoJ29wYWNpdHknLCAnLjInKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgc3ZnUm9vdC5hcHBlbmQocGF0aDEpO1xyXG4gICAgICAgICAgICBpZiAodmlzX2NvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgJChwYXRoMSkuZmFkZUluKDkwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKHBhdGgxKS5mYWRlT3V0KDkwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFNuYXAucGx1Z2luKGZ1bmN0aW9uKFNuYXAsIEVsZW1lbnQsIFBhcGVyLCBnbG9iYWwpIHsgLy8gY3JlYXRlIGNpcmNsZXMgYnkgcGF0aCBlbGVtZW50cyBpbiBzdmdcclxuICAgICAgICAgICAgUGFwZXIucHJvdG90eXBlLmNpcmNsZVBhdGggPSBmdW5jdGlvbihjeCwgY3ksIHIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwID0gXCJNXCIgKyBjeCArIFwiLFwiICsgY3k7XHJcbiAgICAgICAgICAgICAgICBwICs9IFwibVwiICsgLXIgKyBcIiwwXCI7XHJcbiAgICAgICAgICAgICAgICBwICs9IFwiYVwiICsgciArIFwiLFwiICsgciArIFwiIDAgMSwwIFwiICsgKHIgKiAyKSArIFwiLDBcIjtcclxuICAgICAgICAgICAgICAgIHAgKz0gXCJhXCIgKyByICsgXCIsXCIgKyByICsgXCIgMCAxLDAgXCIgKyAtKHIgKiAyKSArIFwiLDBcIjtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGgocCwgY3gsIGN5KTtcclxuXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBwYXRoR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2cnKTtcclxuICAgICAgICBwYXRoR3JvdXAuaWQgPSBcInBhdGhHcm91cFwiO1xyXG4gICAgICAgIHBhdGhHcm91cC5hcHBlbmQocGF0aCk7ICAgICAvL2dyb3VwIHBhdGhzXHJcbiAgICAgICAgc3ZnUm9vdC5hcHBlbmQocGF0aEdyb3VwKTtcclxuICAgICAgICB2YXIgcyA9IFNuYXAocGF0aEdyb3VwKTtcclxuXHJcblxyXG4gICAgICAgIHZhciBjaXJjbGVzQXJyYXkgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjaXJjbGVzQ29vcmRzJykpO1xyXG5cclxuXHJcbiAgICAgICAgJC5lYWNoKGNpcmNsZXNBcnJheSwgZnVuY3Rpb24oaW5kZXgsIGVsKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgY2lyY2xlID0gcy5jaXJjbGVQYXRoKHRoaXMuY3gsIHRoaXMuY3ksIHRoaXMucikuYXR0cih7IC8vc2V0IHBvaW50cyBhdHRyaWJ1dGVzIGFuZCBzdHlsZXMgZnJvbSBwYWdlIHNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICBmaWxsOiBnZXRTZXR0aW5nRnJvbVN0b3JhZ2UoXCJtYXBQb2ludHNDb2xvclwiKSxcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwibWFwUG9pbnRzQm9yZGVyQ29sb3JcIiksXHJcbiAgICAgICAgICAgICAgICBcInN0cm9rZS13aWR0aFwiOiBnZXRTZXR0aW5nRnJvbVN0b3JhZ2UoXCJwb2ludHNCb3JkZXJXaWR0aFwiKSxcclxuICAgICAgICAgICAgICAgIGlkOiBpbmRleCsxLFxyXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwiY2lyY2xlRWxlbWVudFwiLFxyXG4gICAgICAgICAgICAgICAgc3R5bGU6IFwiZGlzcGxheTpub25lXCJcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICB2YXIgaW50ZXJzZWN0cyA9IFNuYXAucGF0aC5pbnRlcnNlY3Rpb24oY2lyY2xlLCAkKHBhdGgpLmF0dHIoJ2QnKSk7IC8vZHJhdyBjaXJjbGVzIGFuZCBtYWluIHJvdXRlIGludGVyc2VjdGlvbnNcclxuXHJcbiAgICAgICAgICAgIGludGVyc2VjdHMuZm9yRWFjaChmdW5jdGlvbihlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHMuY2lyY2xlKGVsLngsIGVsLnksIDEpO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIFBhcmVudENpY2xlR3JvdXAgPSBzdmdSb290LmdldEVsZW1lbnRCeUlkKFwicGF0aEdyb3VwXCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFBhcmVudENpY2xlR3JvdXApO1xyXG4gICAgICAgIGZvcih2YXIgaT0wOyBpIDwgY2lyY2xlc0FycmF5Lmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgdmFyIGNpcmNsZUdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdnJyk7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50UG9pbnQgPSBzdmdSb290LmdldEVsZW1lbnRCeUlkKGkrMSk7XHJcbiAgICAgICAgICAgIGNpcmNsZUdyb3VwLmFwcGVuZChjdXJyZW50UG9pbnQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3RleHQnKTtcclxuICAgICAgICAgICAgJCh0ZXh0KS5hdHRyKHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25hbWUgb2YgcG9pbnRcclxuICAgICAgICAgICAgICAgIHg6IGNpcmNsZXNBcnJheVtpXS5jeCxcclxuICAgICAgICAgICAgICAgIHk6IGNpcmNsZXNBcnJheVtpXS5jeSArIDIwLFxyXG4gICAgICAgICAgICAgICAgXCJmb250LXNpemVcIjogMTIsXHJcbiAgICAgICAgICAgICAgICBcImZvbnQtc3R5bGVcIjogXCJpdGFsaWNcIixcclxuICAgICAgICAgICAgICAgIGZpbGw6IFwiI2NjY2NjY2NcIixcclxuICAgICAgICAgICAgICAgIFwic3R5bGVcIjogXCJkaXNwbGF5OiBub25lXCIsXHJcbiAgICAgICAgICAgICAgICBjbGFzczogXCJjaXR5TmFtZVwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkKHRleHQpLnRleHQoZGF0YUNvbnRlbnRbaV0uY2l0eU5hbWUpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KTtcclxuICAgICAgICAgICAgY2lyY2xlR3JvdXAuYXBwZW5kKHRleHQpO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICBQYXJlbnRDaWNsZUdyb3VwLmFwcGVuZChjaXJjbGVHcm91cCk7ICAgLy9ncm91cCBjaXJjbGVzIGVsZW1lbnRzIHdpdGggdGhlaXIgbmFtZXModGV4dCBlbGVtZW50cylcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1cnJlbnRQb2ludCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzdmdSb290LmFwcGVuZChjaXJjbGVHcm91cCk7ICBcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2YXIgaW50ZXJzZWN0aW9uQ2lyY2xlcyA9IHN2Z0RvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImNpcmNsZVwiKTtcclxuICAgICAgICBmb3IodmFyIGk9MDtpPGludGVyc2VjdGlvbkNpcmNsZXMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgIGludGVyc2VjdGlvbkNpcmNsZXNbaV0uc3R5bGUuZmlsbCA9IFwidHJhbnNwYXJlbnRcIjsgLy9kbyBub3Qgc2hvdyBpbnRlcnNlY3Rpb24gY2lyY2xlc1xyXG4gICAgICAgIH0gICAgICAgICAgICBcclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgcGF0aFN0YXJ0SWNvbiA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJTdGFydFJvdXRlSWNvblwiKSkgfHwgW107XHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIG9QYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7IFxyXG4gICAgICAgICAgICB2YXIgb0RPTSA9IG9QYXJzZXIucGFyc2VGcm9tU3RyaW5nKHBhdGhTdGFydEljb24sIFwidGV4dC94bWxcIik7IC8vUGFyc2luZyBzdHJpbmcgdG8gaHRtbCBlbGVtZW50XHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIHBhcnNlZFBhdGhTdGFydEljb24gPSBvRE9NLmRvY3VtZW50RWxlbWVudDsgXHJcbiAgICAgICAgICAgIHZhciBpY29uT2Zmc2V0WCA9ICQocGFyc2VkUGF0aFN0YXJ0SWNvbikuYXR0cihcImRhdGEtb2Zmc2V0LXhcIik7XHJcbiAgICAgICAgICAgIHZhciBpY29uT2Zmc2V0WSA9ICQocGFyc2VkUGF0aFN0YXJ0SWNvbikuYXR0cihcImRhdGEtb2Zmc2V0LXlcIik7XHJcbiAgICAgICAgICAgIHZhciBpY29uU2NhbGUgPSAkKHBhcnNlZFBhdGhTdGFydEljb24pLmF0dHIoXCJkYXRhLXNjYWxlXCIpO1xyXG5cclxuICAgICAgICAgdmFyIGdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdnJyk7XHJcblxyXG4gICAgICAgIGlmKGdldFNldHRpbmdGcm9tU3RvcmFnZShcIlVzZXJPcHRpb25cIikgPT0gXCJ0cnVlXCIgJiYgZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwiU3RhcnRJY29uXCIpLmxlbmd0aCA+IDApeyAgICAgICAgLy9jaGVjayAxc3Qgc3RlcCB0cmlnZ2VyIGFuZCBzZXQgUm91dGUgc3RhcnQgSWNvblxyXG4gICAgICAgICAgICBmb3IodmFyIGk9MDtpPHBhdGhTdGFydEljb24ubGVuZ3RoO2krKyl7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICQocGFyc2VkUGF0aFN0YXJ0SWNvbikuYXR0cih7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwiUm91dGVTdGFydEljb25Db2xvclwiKSxcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IGljb25TY2FsZVxyXG4gICAgICAgICAgICAgICAgfSk7ICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL3RyYW5zZm9ybSBSb3V0ZSBzdGFydCBJY29uXHJcbiAgICAgICAgJChncm91cCkuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIisocGF0aC5nZXRQb2ludEF0TGVuZ3RoKDEpLnggLSAoZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwiUm91dGVTdGFydEljb25TaXplXCIpL2ljb25PZmZzZXRYKSkgKyBcIiBcIiArIChwYXRoLmdldFBvaW50QXRMZW5ndGgoMSkueSAtIChnZXRTZXR0aW5nRnJvbVN0b3JhZ2UoXCJSb3V0ZVN0YXJ0SWNvblNpemVcIikvaWNvbk9mZnNldFkpICkrXCIpIFwiICsgXCJzY2FsZShcIitnZXRTZXR0aW5nRnJvbVN0b3JhZ2UoXCJSb3V0ZVN0YXJ0SWNvblNpemVcIikvMTAwK1wiKVwiKTtcclxuICAgICAgICBncm91cC5hcHBlbmQocGFyc2VkUGF0aFN0YXJ0SWNvbik7XHJcbiAgICAgICAgc3ZnUm9vdC5hcHBlbmQoZ3JvdXApO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICBpZihnZXRTZXR0aW5nRnJvbVN0b3JhZ2UoXCJjaGVja2JveFN0YXRlXCIpID09IFwidHJ1ZVwiICYmIGdldFNldHRpbmdGcm9tU3RvcmFnZShcImRlZmF1bHRPcHRpb25cIikgPT0gXCJ0cnVlXCIpeyAvL3NldCBkZWZhdWx0IHN0eWxlIFJvdXRlIHN0YXJ0IEljb25cclxuICAgICAgICAgICAgICAgIHZhciBzdGFydENpcmNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnY2lyY2xlJyk7XHJcbiAgICAgICAgICAgICAgICAkKHN0YXJ0Q2lyY2xlKS5hdHRyKHtcclxuICAgICAgICAgICAgICAgICAgICBjeDogcGF0aC5nZXRQb2ludEF0TGVuZ3RoKDEpLngsXHJcbiAgICAgICAgICAgICAgICAgICAgY3k6IHBhdGguZ2V0UG9pbnRBdExlbmd0aCgxKS55LFxyXG4gICAgICAgICAgICAgICAgICAgIHI6IGdldFNldHRpbmdGcm9tU3RvcmFnZShcInBvaW50c1JhZGl1c1wiKSxcclxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6IGdldFNldHRpbmdGcm9tU3RvcmFnZShcIm1hcFBvaW50c0JvcmRlckNvbG9yXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGw6IGdldFNldHRpbmdGcm9tU3RvcmFnZShcIm1hcFBvaW50c0NvbG9yXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IGdldFNldHRpbmdGcm9tU3RvcmFnZShcInBvaW50c0JvcmRlcldpZHRoXCIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCQoc3RhcnRDaXJjbGUpKTtcclxuICAgICAgICAgICAgICAgIHN2Z1Jvb3QuYXBwZW5kKHN0YXJ0Q2lyY2xlKTtcclxuICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIC8vIHN2Z0RvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2lyY2xlJykuc3R5bGUub3BhY2l0eSA9IFwiMFwiO1xyXG5cclxuICAgICAgICB0ZXh0X2NvbnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuXHJcbiAgICAgICAgdmFyIGxlbmd0aCA9IHBhdGguZ2V0VG90YWxMZW5ndGgoKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhsZW5ndGgpO1xyXG4gICAgICAgIHZhciBvZmZzZXREYXNoID0gJChwYXRoKS5jc3Moe1xyXG4gICAgICAgICAgICBcInN0cm9rZS1kYXNob2Zmc2V0XCI6IGxlbmd0aCxcclxuICAgICAgICAgICAgXCJzdHJva2UtZGFzaGFycmF5XCI6IGxlbmd0aCArIFwiIFwiICsgbGVuZ3RoXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBTdG9wUG9pbnRzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc3RvcHNBdExlbmd0aCcpKTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRyYXdQYXRoKCkgeyAgIC8vTWFpbiByb3V0ZSBEcmF3IGFuaW1hdGlvblxyXG4gICAgICAgICAgICB2YXIgY2lyY2xlRWxlbWVudHMgPSBzdmdEb2MucXVlcnlTZWxlY3RvckFsbCgnLmNpcmNsZUVsZW1lbnQnKTtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coY2lyY2xlRWxlbWVudHMpO1xyXG4gICAgICAgICAgICB2YXIgdGV4dEVsZW1lbnRzID0gc3ZnRG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jaXR5TmFtZScpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0ZXh0RWxlbWVudHMpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IFN0b3BQb2ludHMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkLmVhY2goJCgnLmpzLXNlY3Rpb24nKSwgZnVuY3Rpb24oaSwgZWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJChwYXRoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHBlcmNlbnRhZ2VDb21wbGV0ZSA9ICgoJCh3aW5kb3cpLnNjcm9sbFRvcCgpIC0gJCh0aGlzKS5vZmZzZXQoKS50b3ApIC8gJCh0aGlzKS5oZWlnaHQoKSkgKiAxMDA7IC8vY2FsY3VsYXRlIHNlY3Rpb24gb2Zmc2V0IGZyb20gcGFnZSB0b3AgaW4gcGVyY2FudGFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFNlY3Rpb25JRCA9ICQodGhpcykuYXR0cihcImlkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2VjdGlvbklEID0gcGFyc2VJbnQoY3VycmVudFNlY3Rpb25JRFs4XSkgLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJG9mZnNldFVuaXQgPSAkcGVyY2VudGFnZUNvbXBsZXRlICogKFN0b3BQb2ludHNbY3VycmVudFNlY3Rpb25JRF0gLyAxMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgQ3VycmVudFBhdGhDdXJyZW50TGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50UGF0aEN1cnJlbnRMZW5ndGggPSBNYXRoLmZsb29yKCRvZmZzZXRVbml0KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudENpcmNsZSA9IHN2Z0RvYy5nZXRFbGVtZW50QnlJZChjdXJyZW50U2VjdGlvbklEKzEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyRGFzaE9mZnNldCA9IHBhcnNlRmxvYXQoJChwYXRoKS5jc3MoXCJzdHJva2UtZGFzaG9mZnNldFwiKSk7ICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBjaXJjbGVFbGVtZW50cy5sZW5ndGg7IGorKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Q2lyY2xlTmFtZSA9ICQoY3VycmVudENpcmNsZSkucGFyZW50KCkuZmluZChcInRleHRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY3VyRGFzaE9mZnNldCA+PSBsZW5ndGggLSAyMCl7ICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChjaXJjbGVFbGVtZW50c1tqXSkuZmFkZU91dCg5MDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGV4dEVsZW1lbnRzW2pdKS5mYWRlT3V0KDkwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICQoY3VycmVudENpcmNsZU5hbWUpLmZhZGVPdXQoOTAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjaXJjbGVFbGVtZW50c1tqXS5pZCA8PSBjdXJyZW50U2VjdGlvbklEKzEpeyAgICAgICAgICAgICAgICAvL01haW4gcm91dGUgcG9pbnRzIGRpc3BsYXkgYW5kIGZhZGUgb3V0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoY2lyY2xlRWxlbWVudHNbal0pLmZhZGVJbig5MDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRleHRFbGVtZW50c1tqXSkuZmFkZUluKDkwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoY2lyY2xlRWxlbWVudHNbal0uaWQgPiBjdXJyZW50U2VjdGlvbklEKzEgKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChjaXJjbGVFbGVtZW50c1tqXSkuZmFkZU91dCg5MDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRleHRFbGVtZW50c1tqXSkuZmFkZU91dCg5MDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEN1cnJlbnRQYXRoQ3VycmVudExlbmd0aCA8IFN0b3BQb2ludHNbY3VycmVudFNlY3Rpb25JRF0pIHsgLy9kcmF3IHBhdGhcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFNlY3Rpb25JRCA9PSAwICYmIEN1cnJlbnRQYXRoQ3VycmVudExlbmd0aCA8IFN0b3BQb2ludHNbY3VycmVudFNlY3Rpb25JRF0pIHsgLy8gcGF0aCBkcmF3aW5nIHRvIGZpcnN0IHBvaW50XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChwYXRoKS5jc3MoXCJzdHJva2UtZGFzaG9mZnNldFwiLCBcIlwiICsgKGxlbmd0aCAtIEN1cnJlbnRQYXRoQ3VycmVudExlbmd0aCkgKyBcInB4XCIpOyAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFNlY3Rpb25JRCA+IDAgJiYgQ3VycmVudFBhdGhDdXJyZW50TGVuZ3RoIDwgU3RvcFBvaW50c1tjdXJyZW50U2VjdGlvbklEXSkgeyAvLyBwYXRoIGRyYXdpbmcgdG8gbmV4dCBwb2ludFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQocGF0aCkuY3NzKFwic3Ryb2tlLWRhc2hvZmZzZXRcIiwgXCJcIiArIChsZW5ndGggLSAoU3RvcFBvaW50c1tjdXJyZW50U2VjdGlvbklEIC0gMV0gKyBDdXJyZW50UGF0aEN1cnJlbnRMZW5ndGgpKSArIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFN0b3BQb2ludHNbY3VycmVudFNlY3Rpb25JRCAtIDFdICsgQ3VycmVudFBhdGhDdXJyZW50TGVuZ3RoID4gU3RvcFBvaW50c1tjdXJyZW50U2VjdGlvbklEXSkgeyAvL1N0b3AgcGF0aCBkcmF3aW5nIHdoaWxlIHNlY3Rpb24gaW5XaW5kb3dcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHBhdGgpLmNzcyhcInN0cm9rZS1kYXNob2Zmc2V0XCIsIFwiXCIgKyAobGVuZ3RoIC0gU3RvcFBvaW50c1tjdXJyZW50U2VjdGlvbklEXSkgKyBcInB4XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNjcm9sbGVkKGUpIHsgXHJcbiAgICAgICAgICAgIGRyYXdQYXRoKCk7XHJcbiAgICAgICAgICAgIHNlY3Rpb25Db3VudGVyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgJCh3aW5kb3cpLm9uKFwic2Nyb2xsXCIsIHNjcm9sbGVkKTsgICAvL2RyYXcgYW5pbWF0aW9uIG9uIHNjcm9sbFxyXG5cclxuICAgIH0sIGZhbHNlKTtcclxuXHJcbiAgICB2YXIgV3JhcHBlclByb3BzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWFwU3R5bGVQcm9wZXJ0aWVzJykpO1xyXG4gICAgY29uc29sZS5sb2coV3JhcHBlclByb3BzKTtcclxuXHJcbiAgICAgICAgJChcIiNJRG1hcGJnXCIpLmNzcyhcImJhY2tncm91bmQtY29sb3JcIiwgZ2V0U2V0dGluZ0Zyb21TdG9yYWdlKFwiYm9keUJhY2tncm91bmRDb2xvclwiKSApOyAgICAgLy9zZXQgcGFnZSBiZyBjb2xvciBmcm9tIHNldHRpbmdzXHJcblxyXG5cclxuXHJcblxyXG4gICAgJC5lYWNoKFdyYXBwZXJQcm9wcywgZnVuY3Rpb24ocHJvcCwgdmFsdWUpIHtcclxuICAgICAgICAkKFwiI0lEbWFwYmdcIikuY3NzKHByb3AsIHZhbHVlKTsgLy9zZXQgb2Zmc2V0cyBmcm9tIDFzdCBzdGVwXHJcbiAgICB9KTtcclxuXHJcbn0pOyJdfQ==
